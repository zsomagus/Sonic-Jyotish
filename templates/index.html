{% extends "base.html" %}
{% block content %}
<style>
  .utmutato-box {
    display: none;
    background-color: #f5f5f5;
    padding: 1em;
    border-left: 4px solid #888;
    margin-top: 1em;
    font-size: 0.95em;
    line-height: 1.5;
  }
  .toggle-btn {
    cursor: pointer;
    color: #0077cc;
    display: inline-flex;
    align-items: center;
    gap: 0.3em;
    font-weight: bold;
  }
</style>

<div class="toggle-btn" onclick="toggleUtmutato()">
  ‚¨áÔ∏è Haszn√°lati √∫tmutat√≥ megjelen√≠t√©se
</div>

<div id="utmutato" class="utmutato-box">
  <div style="text-align: right; margin-bottom: 0.5em;">
    <span style="cursor: pointer; color: #0066cc;" onclick="toggleLanguage()">üåê English</span>
  </div>
  
  <div id="utmutato-content">
    <ol>
      <li>√çrja be a sz√ºlet√©si adatait, √©s v√°lasszon r√©szhoroszk√≥pot.</li>
      <li>Ha megadja a sz√ºlet√©si helyet, majd a <strong>Kit√∂lt√©s</strong> gombra kattint, automatikusan kieg√©sz√ºlnek a koordin√°t√°k.</li>
      <li>A <strong>Horoszk√≥p rajzol√°sa</strong> gomb menti a k√©pletet PNG form√°tumban.</li>
      <li>A <strong>Lej√°tsz√°s</strong> gombbal meghallgathatja a horoszk√≥pja dallamait.</li>
      <li>A <strong>Prashna</strong> gomb az aktu√°lis id≈ëpontra vonatkoz√≥ k√©pletet t√∂lti ki (alapb√≥l Budapest koordin√°t√°ival).</li>
      <li>A <strong>Varshapala</strong> mez≈ëbe be√≠rhatja az √©letkor√°t, √©s √≠gy √©ves horoszk√≥pot kap.</li>
      <li>Minden k√©pletb≈ël k√©sz√≠thet hangot (wav), valamint kott√°t is (PDF).</li>
    </ol>
    <p>üß≠ A program c√©lja, hogy k√∂nnyed√©n meg√©rthet≈ëv√© tegye a horoszk√≥p √ºzenet√©t ‚Äî ak√°r egy intuit√≠v hang√©lm√©nyen kereszt√ºl is.</p>
  </div>
</div>

<script>
  let isEnglish = false;
  function toggleUtmutato() {
    const utmutato = document.getElementById('utmutato');
    utmutato.style.display = utmutato.style.display === 'none' ? 'block' : 'none';
  }
  
  function toggleLanguage() {
    const content = document.getElementById("utmutato-content");
    if (!isEnglish) {
      content.innerHTML = `
        <ol>
          <li>Enter your birth details and select a divisional chart.</li>
          <li>You can auto-fill coordinates by entering the location and clicking <strong>Fill</strong>.</li>
          <li>Click <strong>Draw Horoscope</strong> to generate a PNG file of your chart.</li>
          <li>Click <strong>Play</strong> to hear the musical translation of your horoscope.</li>
          <li>The <strong>Prashna</strong> button fills the fields with the current time and Budapest coordinates by default.</li>
          <li>For annual chart: enter age and press <strong>Varshapala</strong>.</li>
          <li>You can export sound as WAV and also create a musical PDF score.</li>
        </ol>
        <p>üß≠ The program helps reveal your horoscope's message ‚Äî through sound, rhythm, and cosmic symbolism.</p>
      `;
      isEnglish = true;
    } else {
      content.innerHTML = `
        <ol>
          <li>√çrja be a sz√ºlet√©si adatait, √©s v√°lasszon r√©szhoroszk√≥pot.</li>
          <li>Ha megadja a sz√ºlet√©si helyet, majd a <strong>Kit√∂lt√©s</strong> gombra kattint, automatikusan kieg√©sz√ºlnek a koordin√°t√°k.</li>
          <li>A <strong>Horoszk√≥p rajzol√°sa</strong> gomb menti a k√©pletet PNG form√°tumban.</li>
          <li>A <strong>Lej√°tsz√°s</strong> gombbal meghallgathatja a horoszk√≥pja dallamait.</li>
          <li>A <strong>Prashna</strong> gomb az aktu√°lis id≈ëpontra vonatkoz√≥ k√©pletet t√∂lti ki (alapb√≥l Budapest koordin√°t√°ival).</li>
          <li>A <strong>Varshapala</strong> mez≈ëbe be√≠rhatja az √©letkor√°t, √©s √≠gy √©ves horoszk√≥pot kap.</li>
          <li>Minden k√©pletb≈ël k√©sz√≠thet hangot (wav), valamint kott√°t is (PDF).</li>
        </ol>
        <p>üß≠ A program c√©lja, hogy k√∂nnyed√©n meg√©rthet≈ëv√© tegye a horoszk√≥p √ºzenet√©t ‚Äî ak√°r egy intuit√≠v hang√©lm√©nyen kereszt√ºl is.</p>
      `;
      isEnglish = false;
    }
  }  
</script>

<h2>üå† Horoszk√≥p √©s Hanggener√°l√°s</h2>
<form method="post">
  {% csrf_token %}

  <label>Vezet√©kn√©v:
    <input type="text" name="vezetek_nev" required>
  </label><br>

  <label>Keresztn√©v:
    <input type="text" name="kereszt_nev" required>
  </label><br>

  <label>Sz√ºlet√©si d√°tum:
    <input type="date" name="datum" required>
  </label><br>

  <label>Id≈ë (HH:MM:SS):
    <input type="time" name="ido" required>
  </label><br>

  <label>Sz√©less√©gi fok (latitude):
    <input type="text" name="latitude" required>
  </label><br>

  <label>Hossz√∫s√°gi fok (longitude):
    <input type="text" name="longitude" required>
  </label><br>

  <label>Helysz√≠n / V√°ros:
    <input type="text" name="hely">
  </label><br>

  <label>Id≈ëz√≥na:
    <select name="ido_zona">
      <option value="Europe/Budapest" selected>Europe/Budapest</option>
      <option value="UTC">UTC</option>
      <option value="Asia/Kolkata">Asia/Kolkata</option>
      <!-- kieg√©sz√≠thet≈ë m√°s z√≥n√°kkal -->
    </select>
  </label><br>

  <label>Ny√°ri id≈ësz√°m√≠t√°s:
    <input type="checkbox" name="nyari_idoszamitas" value="igen">
  </label><br>

  <label>R√©szhoroszk√≥p:
    <select name="varga">
      {% for varga in vargak %}
        <option value="{{ varga }}">{{ varga }}</option>
      {% endfor %}
    </select>
  </label><br>

  <button type="submit">Horoszk√≥p rajzol√°sa</button>
  <button type="button" onclick="handlePrashna()">üîÆ Prashna</button>
  <input type="number" id="varshapala_eletkor" placeholder="√âletkor">
  <button type="button" onclick="handleVarshapala()">üï∞Ô∏è Varshapala</button>
  <input type="text" id="Fill_v√°rosn√©v" placeholder="V√°rosn√©v">
  <button type="button" onclick="handleFill()">üìç Kit√∂lt√©s</button>
  <button onclick="document.getElementById('hanglej√°tszo').play()">‚ñ∂Ô∏è Play</button>
  <button onclick="document.getElementById('hanglej√°tszo').pause()">‚è∏Ô∏è Stop</button>
  
  <audio id="hanglej√°tszo">
	<source src="{{ hang_url }}" type="audio/wav">
  </audio>
  <a href="{% static hang_url %}" download>‚¨áÔ∏è Ment√©s WAV</a>
  
  <iframe src="{% static pdf_url %}" width="100%" height="500px"></iframe>
  <a href="{% static pdf_url %}" download>‚¨áÔ∏è Let√∂lt√©s PDF</a>

  {% if hang_url and pdf_url and kep_url %}
    <hr>
    <h3>üî≠ Gener√°lt eredm√©nyek:</h3>

    <h4>üå† Horoszk√≥pk√©p:</h4>
    <img src="{% static kep_url %}" alt="D1 horoszk√≥p" style="max-width: 500px;">
    <a href="{% static kep_url %}" download>‚¨áÔ∏è K√©p let√∂lt√©se</a>

    <h4>üéß Hangf√°jl:</h4>
    <audio controls id="hanglej√°tszo">
      <source src="{% static hang_url %}" type="audio/wav">
    </audio>
    <a href="{% static hang_url %}" download>‚¨áÔ∏è Ment√©s WAV</a>

    <h4>üéº Kott√°zott PDF:</h4>
    <iframe src="{% static pdf_url %}" width="100%" height="500px"></iframe>
    <a href="{% static pdf_url %}" download>‚¨áÔ∏è Let√∂lt√©s PDF</a>
  {% endif %}

  {% if poszt.yantra_kep %}
    <h4>üßò Tithi Yantra</h4>
    <img src="{{ poszt.yantra_kep.url }}" style="max-width: 200px;">
    <p>Tithi sz√°ma: {{ poszt.tithi_szam }}</p>
  {% endif %}

  {% if poszt.szoveg %}
    <p><strong>üéôÔ∏è Felismert sz√∂veg:</strong> {{ poszt.szoveg }}</p>
  {% endif %}

  {% if poszt.ai_valasz %}
    <p><strong>ü§ñ AstroAI v√°lasza:</strong><br>{{ poszt.ai_valasz }}</p>
  {% endif %}

</form>

<script>
  async function handleFill() {
    const varos = document.querySelector('input[name="hely"]').value;
    if (!varos) {
      alert("K√©rlek, √≠rj be egy v√°rost.");
      return;
    }

    const response = await fetch(`/get-koordinatak/?varos=${encodeURIComponent(varos)}`);
    if (response.ok) {
      const data = await response.json();
      document.querySelector('input[name="latitude"]').value = data.latitude;
      document.querySelector('input[name="longitude"]').value = data.longitude;
    } else {
      alert("Nem tal√°ltam ilyen v√°rost az adatb√°zisban.");
    }
  }
</script>

{% endblock %}